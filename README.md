# Проектная работа "Веб-ларек"

## SSH

```
git@github.com:Den4ikgo2/web-larek-frontend.git
```

## HTTPS

```
https://github.com/Den4ikgo2/web-larek-frontend.git
```

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с TS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Создание типов, которые можно переиспользовать

```
export type TBasketInfo = Pick<IBasket, 'addProduct' | 'removeProduct'>;
export type TProductsAPI = Pick<IMainPage, 'setProduct' | 'getProduct'>;
export type TUSerForm = Pick<IUser, 'paymentTerms' | 'address'>;
export type TUserData = Pick<IUser, 'email' | 'telephone'>;
```

## Интерфейс брокера событий

```
export interface IEventEmitter {
	emit: (event: string, data: unknown) => void;
}
```

## Интерфейс для продукта

```
export interface IProductData {
	categoryProduct: string;
	titleProduct: string;
	imageProduct: string;
	priceProduct: number;
	descriptionProduct: string;
	idProduct: string;
}
```

## Интерфейс главной страницы

```
export interface IMainPage {
	catalogProducts: IProductData[];
	preview: string | null;
	numberProducts: number;
	setProduct(items: IProductData[]): void;
	getProduct(id: string): void;
	openProduct(): void;
}
```

## Интерфейс корзины

```
export interface IBasket {
	items: Map<string, number>;
	addProduct(id: string): void;
	removeProduct(id: string): void;
}
```

## Интерфейс данных пользователя

```
export interface IUser {
	paymentTerms: void;
	address: string;
	email: string;
	telephone: number;
}
```

## Интерфейсы для конструктора. Отображение правильного модального окна, на входе в контейнер, в него будем выводить

```
interface IViewConstructor {
	new (container: HTMLElement, events?: IEventEmitter): IView;
}
```

## Интерфейс для самого класс отображения. Получает данные, возвращает в HTML разметке

```
interface IView {
	render(data?: object): HTMLElement;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   


### Слой данных

#### Класс ShowAPI
Класс отвечате за загрузку всего списка товара с сервера и передачи данных для наполнения главной страницы товарами.\
Содержит свойства:
- items - список свойст одного товара
- id - уникальный номер товара
Имеет методы:
- setProduct(items: IProduct[]): void{}; - метод отвечает за получение карточки товара с сервера
- getProduct(id: string): void{}; - метод отвечает за передачу полученного товара с серверу в любое другое место

#### Класс ModalData
Класс отвечает за работу модальных окон, а именно за их отображение после выполнение событий, через брокер событий `IEventEmitter`. Класс выполняет проверку валидации, в случае не валдиности кнопки и input-элементы становятся другого цвета. А также кнопки отвечающее за "продолжение офрмление заказа" становятся не чувствительны к методу `emit`\
Имеет свойства:
- amountProduct:number - Хранит сумму всех товаров находящихся в корзине и в форме "Заказ выполнен успешно"
Методы:
- checkValidation(): void {} - выполняет проверку валидации всех модальных окон
- showAmount(element: number): void {}; - метод сумирующирй сумму всех товаров отправленых в корзину
- buyProduct(): void {} - метод для отправки продукта в корзину

#### Класс BasketData
Класс расширяющий класс `ModalData`. Обрабатывает данные по добавлению и удалению продуктов в корзину. Работает после выполнение событий через броуер событий `IEventEmitter`.\
Свойства:
- _id: string - id продукта над которым происходит манипуляция
Методы:
- addProduct(_id: string): void {} - добавление продукта в корзину
- removeProduct(_id: string): void {} - удаление продукта с корзины

#### Класс UserFormData
Класс расширяет работу класса `ModalData`. Предназначен для работы с данными пользователя по форме оплаты и адреса доставки.\
Свойства:
- paymentTerms: void - свойство хранщее в себе способ оплаты где true - "Онлайн", а false - "При получении"
- address: string;
МАетоды:
- setPaymentTerms(): void {} - метод устанавливает способ оплаты
- setAddress(): void {} - метод для установления адреса доставки

#### Класс UserData
Класс расширяет работу класса `ModalData`. Содержит персональные данные пользователя, а именно email и номер телефона\
Свойства:
- email: string - свойство для хранения email
- telephone: number - свойство для хранения номера телефона
Методы:
- setEmail(): void {} - метод для установки email
- setPhone(): void {} - метод для устновки номера телефона

### Классы представления
Все класс представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемые в них данные.

#### Класс components
Отвечает за отображение модальных окон, форм и главное страницы. Основная работа отобразить HTML-разметку после выполнения какого-либо событие от брокер-события `IEventEmitter`. использует интерфейс `IView` благодаяря которому и отображает HTML-разметку\
Свойства:
htmlElement: HTMLElement - свойство хранящее в себе переменную в виде HTML-разметки. Используется один раз, для исключения дублирований в коде по обращению к HTML
Методы:
- constructor(protected container: HTMLElement) {} - пеередается HTML-разметка которую нужно отобразить на экране
- estimateProducts(): void {} - метод для отображение сумму товров после событий удаления/добавления товра в коризну
- changeValiodation(): void {} - метод отвечающий за отображение валидности модальных окон

#### Класс MainView
Расширяет класс `components`. Отвечает за отображение главного экрана страницы.\
Имеет методы:
- renderMainNumberProducts(): void {} - Отображение количества товаров в корзине, возле иконки корзины
- renderMainProduct(): void {} - Отображение каталога с продуктами на главной странице
- blackoutMain(): void {} - Затемнение при вызове модального окна главной странице на фоне
- blackoutNotMain(): void {} - Снятие затемнение при закртии модального окна

#### Класс ModalView
Расширяет класс `components`. Отвечате за отображение всех моадльных окон на странице.\
Имеет методы:
- renderModalWindow(): void {} - Отображение выбранного модального окна
- closeModalWindow(): void {} - Очистка модального окна

#### Класс FormView
Расширяет класс `components`. Отвечате за отображение всех форм на странице.\
Имеет методы:
- renderInput(): void {} - Отображение поля ввода формы
- closeInput(): void {} - метод отвечающий за очстку формы
- changeTextValidation(): void {} - метод отвечающий отображение валидности формы

#### Класс BasketView
Расширяет класс `components`. Класс для отображения модального окна корзины, при изменениях 
исключащие из себя события закрытия модального окнва корзины или обновления страницы\
Методы:
- renderArrayProducts(): void {} - отображение списка товаров корзины после выполнение событий над списком товаров в корзине

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `user:changed` - изменение данных пользователя
- `product:selected` - изменение открываемой в модальном окне продукта
- `user:previewClear` - необходима очистка данных модальных окон данных пользователя

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `product:open` - открытие модального окна продукта (одной карточки)
- `basketMain:open` - открытие модального окна корзины с главной страницы
- `basketProduct:open` - открытие модального окна корзины с модального окна карточки
- `product:select` - выбор продукта для отображения в модальном окне
- `productBasket:delete` - выбор продукта для удаления с корзины
- `user-profile:input` - изменение данных в форме с данными пользователя
- `user-profile:submit` - сохранение данных пользователя в модальном окне
- `button:submit` - событие, генерируемое при нажатии кнопки перехода к следующей форме
- `user-profile:validation` - событие, сообщающее о необходимости валидации форм gjkmpjdfntkz

