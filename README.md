# Проектная работа "Веб-ларек"

## SSH

```
git@github.com:Den4ikgo2/web-larek-frontend.git
```

## HTTPS

```
https://github.com/Den4ikgo2/web-larek-frontend.git
```

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с TS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Список товаров

```
export interface ICardsData {
	items: ICard[];
}
```

Свойства карточки/товара

```
export interface ICard {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
	index: number;
}
```

Типы запросов на сервер

```
export type ApiPostMethods = 'POST' | 'GET';
```

Подготовка интерфейса API

```
export interface IApi {
    baseUrl: string;
    get<T>(uri: string): Promise<T>;
    post<T>(uri: string, data: object, method?: ApiPostMethods): Promise<T>;
}
```

Подготовка интерфейса страницы приложения

```
export interface IPage {
	content: HTMLElement[];
	counter: number;
}
```

Подготовка интерфейса, для реализации возможности использования объектов события

```
export interface ICardActions{
	onClick: () => void;
}
```

Подготовка интерфейса с свойствами формы заказа

```
export interface IOrderForm {
	payment: string,
    email: string,
    phone: string,
    address: string,
	total: number,
}
```

Подготовка интерфеса, для отображения всех Id карточек, находящихся в списке покупок

```
export interface IOrder extends IOrderForm {
    items: string[]
}
```

Тип для реализации проверки на валидность форм приложения

```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```

Подготовка интерфейса, содержащего в себе свойства массива из HTML-элементов

```
interface ICardsContainer {
    catalog: HTMLElement[];
}
```

Интерфейс отвечающий зп азпимодействие между элементами и последеющего вызова брокера событий

```
export interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void;
    emit<T extends object>(event: string, data?: T): void;
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}
```

Интерфес содержит в себе свойства корзины

```
interface IBasketView {
    items: HTMLElement[];
    total: number;
    selected: string[];
}
```

Интерфейс неоьходимый для проверки формы заполнения

```
interface IFormState {
    valid: boolean;
    errors: string[];
}
```

Интерфейс модального окна

```
interface IModal {
    content: HTMLElement
}
```

Интерфейс модального окна, завершение покупки

```
interface ISuccess {
    total: number;
}
```

Интерфейс для возврата объекта

```
interface ISuccessActions {
    onClick: () => void;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс CardsData
Класс предназначен для работы с данными карточек. Хранит в себе массив погруженных карточек с сервера и массив карточек в корзине. \

В полях классах хранятся следующие свойства:
- protected events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- protected _items: ICard[] - массив объектов карточек, подгруженных с сервера
- protected _basketCardArray: Array<ICard> - массив объектов карточек, находящихся в корзине
- protected _priceBasket: number - свойсвто для хранения в себе стоимости товаров в корзине
- protected category: {[key: string]: string} - свойство содержащая в себе объект со списком значений, которые необходимо добавить к наименованию класса, для правильного отображения категории

Имеет методы для взаимодействия с данными:
- pushCardInBasket(card: ICard) - метод позволяет добавить выбранную карточку в корзину
- sumCardsInBasket(item: number) - метод позволяет определить общую сумму карточек в корзине
- subtractionCardsInBasket(item: number) - метод позволяет расчитать сумму карточек в корзине, при удалении карточек
- setOrderField(field: keyof IOrderForm, value: string) - метод для работы с валидацией карточки оплаты, позволяет выброать поле по которому нужно провести валидацию
-setContactsField(field: keyof IOrderForm, value: string) - метод для работы с валидацией карточки контактных данных, позволяет выброать поле по которому нужно провести валидацию
- validateOrder() - метод для вызова брокера событий валидации и хранящий в себе текст ошибки валидации для формы оплаты, в случае не валидности формы.
- validateContacts() - метод для вызова брокера событий валидации и хранящий в себе текст ошибки валидации для формы контактов, в случае не валидности формы.
- clearBasket() - очистка корзины от списка товаров и зануление стоимости товаров
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса
- definitionCategory(item: string) - метод позволяет выбрать правильный цвет категории из объекта `` и передаёт занчение правильного наименования класс категории

#### Класс AppApi
Класс предназначен для получения карточек с сервера и отправки итоговой формы заказанного продукта.\

Имеет свойства:
- private _baseApi: IApi - Принимает базовый адрес страницы откуда надо подтянуть остальные карточки
- readonly cdnApi: string - Содержит часть адреса необходимую для прогрузки картинок под карточки

Имеет методы:
- getCards() - метод отвечает за получение карточек с сервера
- orderLots(order: IOrder) - метод овтечает за отправку итоговой формы заказа на сервер

### Классы представления
Все класс представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемые в них данные.

#### Класс Component
Абстрактный класс отвечающий за рендtр всего, что можео увидеть на экране. \

Имеет метод:
- render(data?: Partial<T>) - метод отвечающий за вывод информавции на экран

#### Класс CardContainers
Расширяет класс Component. Выводит на экран все загрудженные карточки с сервера.\
Имеет сеттер `catalog`, позволяющий по очереди выводит карточки на экран

#### Класс Page
Расширяет класс Component. Отвечает за отоброжение главной страницы, а именно за основное место размещение карточек (именно сюда размещаются карточки с помощью `CardContainers`) и за иконко корзину (вместе с счётчиком)\

Из методв есть только сеттеры:
- Содержит сеттер `counter` принимающий число элементов в массиве корзины, для последющего отображения
- Содержит сеттер `content` позволяющий разместить списко карточек на главной странице

#### Класс Modal
Расширяет класс Component. Отвечает за отображение всех модальных окон. За их закрытие, открытие (также обнуляет информацию отображение по моадльному окну). \

Имеет свойства:
- protected closeButton: HTMLButtonElement; - кнопка закрытиме модального окна
- protected _content: HTMLElement; - содержимое модального окна

Имеет методы:
- open() - Открытие модального окна
- close() - Закртиые модального окна
- render(data: IModal) - дополнительная отрисовка при стандартной отрисовки через наследуемый класс `Component`

#### Класс Basket
Расширяет класс Component. Отвечает за отбражение корзины в модальном окне, реагирует на удаление карточек товра с корзины. \

Содержит свойства:
- protected _list: HTMLElement; - Список элементов в корзине
- protected _total: HTMLElement; - Полная стоимость всех элементов в корзине
- protected _button: HTMLElement; - Кнопка корзины, позволяющая перецти к следующему модальному окно

Содержит в скбе сеттер `items` отвечающий за роазмещение элементов для покупки в корзине

#### Класс Form
Расширяет класс Component. Отвечает за отображенние всех форм содержащихся на странице и их валидность.\

Содержит свойства:
- protected _submit: HTMLButtonElement; - свойство для работы с submit формы
- protected _errors: HTMLElement; - свойство для отображения ошибок
- protected _buttonOnline: HTMLButtonElement; - свойство кнопки для оплаты заказа онлайн
- protected _buttonHandse: HTMLButtonElement; - свойство кнопки для оплаты заказа при получении

Содержит методы:
- onInputChange(field: keyof T, value: string) - метод отвечает за проверку валидности формы
- render(state: Partial<T> & IFormState) - расширяет рендер родительского класса
- Есть сеттеры, который принимает ошибки при заполенении и их подсвечивает

#### Класс Contacts
Расширяет класс Form. Содержит в себе сеттеры номера телефона и email

#### Класс Order
Расширяет класс Form. Содержит в себе сеттеры адрема и кнопок способа получения товара

#### Класс ISuccess
Расширяет класс Component. Выводит модальное окно о том что покупка совершена

### Слой коммуникации

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `cards:changed` - изменение модели карточек
- `card:select` - выбор карточки
- `initialData: loaded` - инициализация закгрузки карточек

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `basket:open` - открытие корзины
- `order:open` - открытие формы заказа
- `card:addInBasket` - добавление в корзину
- `basket:deleteCard` - удаление с корзины
- `auction:changed` - действие над объектом
- `order:ready` - форма заказа заполнена
- `contacts:ready` - форма контактов заполнена
- `formErrorsOrder:change` - есть ошибки в форме заказа
- `formErrorsContacts:change` - есть ошибки в форме контактов
- `formButton:buyHandse` - выбор оплаты при получении
- `formButton:buyOnline` - выбор оплаты онлайн
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна